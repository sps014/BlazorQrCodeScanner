@page "/"
@using BlazorQrCodeScanner
@using System.Drawing
@using BlazorQrCodeScanner.MediaTrack

<QrCodeScanner @ref="qrCodeScanner" OnCreated="InstanceCreated" OnScannerStarted="ScanStarted"/>

@code
{
	private QrCodeScanner? qrCodeScanner;

	protected override Task OnInitializedAsync()
	{
		return base.OnInitializedAsync();
	}
	private void InstanceCreated()
	{
		qrCodeScanner?.StartAsync(new MediaTrackConstraintSet
		{
			FacingMode = VideoFacingMode.Environment
		},
		new QrCodeConfig()
		{
			QrBox= new QrBoxFunction(QrBoxFunc)
		});
	}

	private async void ScanStarted()
	{
		var r = await qrCodeScanner!.GetStateAsync();

		await Task.Delay(500);
		var s = await qrCodeScanner.GetRunningTrackCameraCapabilitiesAsync();

	}

	private SizeF QrBoxFunc(SizeF viewPortSize)
	{
		double minEdgePercentage = 0.999; // 70%
		double minEdgeSize = Math.Min(viewPortSize.Width, viewPortSize.Height);
		int qrboxSize = (int)Math.Floor(minEdgeSize * minEdgePercentage);

		return new (qrboxSize,150);
	}
}